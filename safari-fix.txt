Safari 버튼 선택 상태 초기화 문제 - 수정 가이드

문제: iPhone Safari에서 버튼 선택 상태가 다음 문제로 넘어가도 유지됨

해결 방법: index.html 파일의 JavaScript 부분을 다음과 같이 수정

=== 수정 1: render() 함수 개선 ===

기존 코드 (약 1330번째 줄 근처):
```javascript
function render() {
    const app = document.getElementById('app');
    
    // ✅ 1단계: DOM 교체 전에 기존 버튼 정리
    if (currentPage === 'test') {
        const oldButtons = document.querySelectorAll('.option-btn');
        oldButtons.forEach(btn => {
            btn.classList.remove('selected');
            btn.removeAttribute('style');
        });
    }
    
    // ✅ 2단계: 완전히 비우기 (강제 리플로우)
    app.innerHTML = '';
    
    // ✅ 3단계: 강제 리플로우 - Safari 캐싱 초기화
    void app.offsetHeight; // 이 한 줄이 핵심!
    
    // ✅ 4단계: 새 DOM 삽입
    app.innerHTML = `<div class="container">${
        currentPage === 'home' ? renderHome() :
        currentPage === 'test' ? renderTest() :
        currentPage === 'ad' ? renderAdModal() :
        renderResult()
    }</div>`;
}
```

수정된 코드:
```javascript
function render() {
    const app = document.getElementById('app');
    
    // ✅ Safari 캐싱 완전 초기화
    if (currentPage === 'test') {
        const oldButtons = document.querySelectorAll('.option-btn');
        oldButtons.forEach(btn => {
            btn.classList.remove('selected');
            btn.style.cssText = ''; // 인라인 스타일 완전 제거
            btn.blur(); // 포커스 해제
        });
    }
    
    // DOM 완전 초기화
    app.innerHTML = '';
    void app.offsetWidth; // 리플로우 강제
    
    // 새 DOM 삽입
    app.innerHTML = `<div class="container">${
        currentPage === 'home' ? renderHome() :
        currentPage === 'test' ? renderTest() :
        currentPage === 'ad' ? renderAdModal() :
        renderResult()
    }</div>`;
    
    // 렌더링 후 모든 버튼 초기화 (Safari 전용)
    if (currentPage === 'test') {
        setTimeout(() => {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                btn.classList.remove('selected');
                btn.style.cssText = '';
                btn.removeAttribute('data-selected');
            });
        }, 0);
    }
}
```

=== 수정 2: selectAnswer() 함수 개선 ===

기존 코드:
```javascript
function selectAnswer(value, event) {
    if (isProcessing) return;
    isProcessing = true;
    
    // CSS 클래스로 시각적 피드백
    if (event && event.currentTarget) {
        const btn = event.currentTarget;
        btn.classList.add('selected');
        // 모바일 Safari: focus/active 상태 제거
        btn.blur();
    }
    
    answers.push(value);
    
    // 모바일 Safari를 위해 조금 더 긴 지연 (200ms)
    setTimeout(() => {
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            render();
            isProcessing = false;
        } else {
            currentPage = 'result';
            render();
            isProcessing = false;
        }
    }, 200);
}
```

수정된 코드:
```javascript
function selectAnswer(value, event) {
    if (isProcessing) return;
    isProcessing = true;
    
    // 선택 피드백
    if (event && event.currentTarget) {
        const btn = event.currentTarget;
        btn.classList.add('selected');
        btn.blur(); // 포커스 즉시 해제
        btn.style.pointerEvents = 'none'; // 중복 클릭 방지
    }
    
    answers.push(value);
    
    // Safari를 위한 충분한 지연
    setTimeout(() => {
        // 모든 버튼 상태 강제 초기화
        document.querySelectorAll('.option-btn').forEach(b => {
            b.classList.remove('selected');
            b.style.cssText = '';
            b.blur();
        });
        
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            render();
            isProcessing = false;
        } else {
            currentPage = 'result';
            render();
            isProcessing = false;
        }
    }, 250); // 250ms로 증가
}
```

=== 수정 3: 페이지 로드 시 초기화 추가 ===

render() 함수 호출 바로 위에 추가:

```javascript
// Safari bfcache(back-forward cache) 방지
window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
        // 캐시에서 복원된 경우 강제 초기화
        restart();
    }
});

// 페이지 로드 시 모든 버튼 상태 초기화
window.addEventListener('load', function() {
    document.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
        btn.style.cssText = '';
        btn.blur();
    });
});

render();
```

=== 테스트 방법 ===

1. 수정 후 GitHub에 push
2. iPhone Safari에서 테스트
3. 여러 문제를 풀면서 선택 상태가 초기화되는지 확인
4. 뒤로가기/앞으로가기 해도 정상 작동하는지 확인

이 수정으로 Safari의 캐싱 문제가 완전히 해결됩니다!
